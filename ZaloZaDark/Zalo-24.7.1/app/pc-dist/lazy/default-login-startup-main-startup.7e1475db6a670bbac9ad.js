(this.webpackJsonp=this.webpackJsonp||[]).push([[13],{FX2a:function(e,t,s){"use strict";s("0rWR"),s("Lq8m"),s("nUpV"),s("5yGw"),s("hRcX"),s("gpNb"),s("rhBN"),s("cF85"),s("ejhj"),s("8eBJ");var n,o=s("8/YW"),i=s("PmZf"),r=s("tHMN"),a=s("1UUk"),c=s("jDHv"),d=s("fsN4"),l=s("Mgpg");let u=c.ModuleContainer.injectable()(n=function(e,t){return c.ModuleContainer.inject(r.b)(e,void 0,0)}(n=function(e,t){return c.ModuleContainer.inject(l.ZLoggerFactory)(e,void 0,1)}(n=Reflect.metadata("design:type",Function)(n=Reflect.metadata("design:paramtypes",[void 0===r.a?Object:r.a,void 0===l.ZLoggerFactory?Object:l.ZLoggerFactory])(n=class extends a.a{constructor(e,t){super(),this.engine=e,this.logger=void 0,this.logger=t.createZLogger("db",["host"]),this.registerListeners()}registerListeners(){const e=e=>this.dispatchEvent(e);this.engine.addEventListener(i.b.UnexpectedError,e),this.engine.addEventListener(i.b.QueryExec,e),this.engine.addEventListener(i.b.QueryError,e),this.engine.addEventListener(i.b.SuccessOpenDB,e),this.engine.addEventListener(i.b.ConnectionClosedAbnormally,e)}install(){$zsub.$zdb.onRequestCloseDbs((async(e,t)=>{this.logger.zsymb(0,"uuT1Bq","closing requested databases ..."),await this._closeDBs(t),$zdb.notifyFinishCloseDb(__ZaBUNDLENAME__),this.logger.zsymb(0,"8Pn2RB","closed database")})),$zdb.notifyDbConnected(__ZaBUNDLENAME__);const e=c.ModuleContainer.resolve(o.a);e.addEventListener(o.b.Authenticated,(e=>{this.authenticate(e.getSession())})),e.currentSession&&this.authenticate(e.currentSession)}areYouOk(){return!0}authenticate(e){var t;e&&(this.session=e,this.dispatchEvent(new i.e(e)),this.logger.zsymb(0,"DjSuI2",(()=>["authenticated",`id: ${e.userId}`])),null!==(t=window.$zenv)&&void 0!==t&&t.isPreloaded&&$zdb.authenticateDb(e))}async _closeDBs(e){const t=d.default.getInstance(),s=this.logger;let n=[];if(e){if(e.length){let o=[...e];s.zsymb(3,"mLjHso",["Start closing dbs: {}","sAZ336"],e),s.zsymb(3,"WJHkL1",["Wait for dbs to be closed: {}","VJzu2r"],o),n=e.map((async e=>{await t[e].closeThisDatabase(),o=o.filter((t=>t!==e)),0===o.length?s.zsymb(0,"xR1hZx","Done closing dbs"):s.zsymb(3,"yPVlyd",["Wait for dbs to be closed: {}","VJzu2r"],o)}))}}else n=[t.closeAllDatabases()];await Promise.all(n)}async closeDBs(e){var t;this.logger.zsymb(0,"yAW4sI","send closing requested databases signal"),null!==(t=window.$zenv)&&void 0!==t&&t.isPreloaded&&(await $zdb.requestCloseDbs(e,__ZaBUNDLENAME__),this.logger.zsymb(0,"wHe2Id","All clients have finished closing the requested DBs"))}})||n)||n)||n)||n)||n;c.ModuleContainer.registerSingleton(a.b,u);const h=Object(c.define)("database-monitor");class m{constructor(e,t){this.name=void 0,this.description=void 0,this.count=void 0,this.info=void 0,this.name=e,this.description=t,this.count=0,this.info={}}report(e){this.count++,"string"!=typeof e?e.reduce(((e,t)=>(this.handleIssue(e,t),e[t].child)),this.info):this.handleIssue(this.info,e)}handleIssue(e,t){e[t]||(e[t]={count:0,child:{}}),e[t].count++}}var b;let g=c.ModuleContainer.injectable()(b=function(e,t){return c.ModuleContainer.inject(l.ZLoggerFactory)(e,void 0,0)}(b=function(e,t){return c.ModuleContainer.inject(a.b)(e,void 0,1)}(b=Reflect.metadata("design:type",Function)(b=Reflect.metadata("design:paramtypes",[void 0===l.ZLoggerFactory?Object:l.ZLoggerFactory,void 0===a.a?Object:a.a])(b=class{constructor(e,t){this.loggerFactory=e,this.databaseManager=t,this.queryErrorReport=void 0,this.renderCallback=void 0,this.logger=void 0,this.queryErrorReport=new m("QueryError","Exception when execute query"),this.renderCallback=[],this.logger=this.loggerFactory.createZLogger("db",["monitor"])}install(){this.databaseManager.addEventListener(i.b.QueryError,(e=>this.onQueryError(e.error)))}listen(e){return this.renderCallback.push(e),()=>{this.renderCallback=this.renderCallback.filter((t=>t!==e))}}onQueryError(e){this.logger.zsymb(18,"rpskKc",(()=>["query-error",e.name,e.message])),this.queryErrorReport.report([e.name]),this.renderCallback.forEach((e=>e()))}})||b)||b)||b)||b)||b;c.ModuleContainer.registerSingleton(h,g)},Ppsz:function(e,t,s){"use strict";var n=s("jDHv"),o=s("hmll"),i=s("1pet"),r=s("NL/6");const a=[{chord:`${i.CmdOrCtrl}${i.K_I}`,commandId:r.a.FOCUS_MAIN_CHAT_INPUT_AT_ACTIVE_WINDOW,commandTitle:"",isMatchedContext:(e,t)=>!0},{chord:`${i.CmdOrCtrl}${i.K_I}`,commandId:r.a.APPLY_ITALIC_STYLE_FOR_SELECTED_TEXT,commandTitle:"",isMatchedContext:(e,t)=>!0},{chord:`${i.CmdOrCtrl}${i.K_B}`,commandId:r.a.APPLY_BOLD_STYLE_FOR_SELECTED_TEXT,commandTitle:"",isMatchedContext:(e,t)=>!0},{chord:`${i.CmdOrCtrl}${i.K_U}`,commandId:r.a.APPLY_UNDERLINE_STYLE_FOR_SELECTED_TEXT,commandTitle:"",isMatchedContext:(e,t)=>!0},{chord:`${i.CmdOrCtrl}${i.Shift}${i.K_X}`,commandId:r.a.TOGGLE_RTF_MODE,commandTitle:"",isMatchedContext:(e,t)=>!0}];n.ModuleContainer.register(o.a,class{constructor(){this._keybindings=[],a.forEach((e=>{this._keybindings.push({chord:e.chord,commandId:e.commandId,commandTitle:e.commandTitle,isMatchedContext:e.isMatchedContext,eventHandlers:[]})}))}registerEventHandlerByCommandId(e,t){return e&&t?(this._keybindings.forEach((s=>{s.commandId!==e||s.eventHandlers.includes(t)||s.eventHandlers.push(t)})),()=>{this._keybindings.forEach((s=>{s.commandId===e&&s.eventHandlers.includes(t)&&(s.eventHandlers=s.eventHandlers.filter((e=>e!==t)))}))}):()=>{}}loopkupKeybindingByCommandId(e){return e?this._keybindings.reduce(((t,s)=>(e===s.commandId&&t.push(s),t)),[]):[]}loopkupKeybindingByChord(e){return e?this._keybindings.reduce(((t,s)=>(e===s.chord&&t.push(s),t)),[]):[]}});var c=s("XRso"),d=s("Xt6Q");n.ModuleContainer.register(c.a,class{buildChord(e){let t="";return e&&this._isChord(e)&&((e.ctrlKey||e.metaKey)&&(t+=i.CmdOrCtrl),e.shiftKey&&(t+=i.Shift),e.altKey&&(t+=i.Alt),t+=e.keyCode||e.which),t}buildKeybindingContext(e,t){return e&&t?`${e}#${t}`:""}getChordByCommandId(e){return e===r.a.TOGGLE_RTF_MODE?(Object(d.c)()?"Cmd":"Ctrl")+" + Shift + X":""}_isOnlyModifier(e){return["Shift","Control","Alt","Meta"].includes(e.key)}_isOnlyNonModifier(e){return!(e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)}_isChord(e){return!(this._isOnlyModifier(e)||this._isOnlyNonModifier(e))}})},TGaw:function(e,t,s){"use strict";var n=s("jDHv"),o=s("8/YW"),i=(s("jw3m"),s("Y58e")),r=s("UGJm");let a=function(e){return e.Idle="Idle",e.Active="Active",e}({});var c=s("AH6j");let d=function(e){return e[e.idle=0]="idle",e[e.active=1]="active",e}({});class l extends c.b{constructor(e){super(),this.status=d.active,this.window=void 0,this.idleDelay=void 0,this.minimumIdlePeriod=void 0,this.lastIdleTime=void 0,this.focusStateChangeDebounceTimer=void 0,this.handleDocumentBlur=()=>{this.resetFocusStateChangeDebounceTimer(),this.focusStateChangeDebounceTimer=setTimeout((()=>{this.setStateToIdle()}),this.idleDelay)},this.handleDocumentFocus=()=>{this.resetFocusStateChangeDebounceTimer(),this.setStateToActive()},this.idleDelay=e.idleDelay,this.minimumIdlePeriod=e.minimumIdlePeriod,this.window=e.window||window,this.lastIdleTime=0,this.focusStateChangeDebounceTimer=null}start(){this.window.addEventListener("blur",this.handleDocumentBlur),this.window.addEventListener("focus",this.handleDocumentFocus)}stop(){this.window.removeEventListener("blur",this.handleDocumentBlur),this.window.removeEventListener("focus",this.handleDocumentFocus)}onIdle(e){return this.addEventListener(a.Idle,e)}setStateToActive(){this.status!==d.idle||(this.status=d.active,this.dispatchEvent(new Event(a.Active)))}setStateToIdle(){if(this.status!==d.active)return;this.isThrottlingIdleState()||(this.lastIdleTime=Date.now(),this.status=d.idle,this.dispatchEvent(new Event(a.Idle)))}isThrottlingIdleState(){return Date.now()-this.lastIdleTime<this.minimumIdlePeriod}resetFocusStateChangeDebounceTimer(){this.focusStateChangeDebounceTimer&&(clearTimeout(this.focusStateChangeDebounceTimer),this.focusStateChangeDebounceTimer=null)}}var u=s("wx14"),h=s("q1tI"),m=s.n(h),b=s("/MKj"),g=s("FK2X"),p=s("emRR"),v=s("xrk1"),E=s("ZBGy"),C=s("T1Xd"),_=s("uzdi");const O=Object(_.a)();function f(){const e=O.useRecoilSnapshot();return O.setSnapShot(e),null}var y=s("QVmZ"),T=s("72hn"),I=s("ZlRg"),D=s("VaDh"),S=s("CzFt"),w=s("h0sc"),M=s("1pet"),A=s("L+5E"),L=s("UiPd"),j=s("Yi2m"),R=s("6uTC"),z=s("c51z"),N=s("sqm0"),F=s("NTw/");var $=s("hI9i");const P=()=>{const e=Object(b.f)(),t=Object(h.useMemo)((()=>Object(E.d)(e)),[e]),s=Object(E.c)(),n=Object(b.g)((e=>({user:e.user,popup:e.popup,status:e.status,profile:e.profile,zaviState:e.zaviState,chatview:e.chatview})),((e,t)=>e.user==t.user&&e.popup==t.popup&&e.status==t.status&&e.profile==t.profile&&e.zaviState==t.zaviState&&e.chatview==t.chatview));return(e=>{const t=Object(h.useCallback)((()=>{w.ModalManagerV2.openModal({windowId:"1",name:M.ModalIdentitiesDefine.SETTINGS,params:!0,forceCloseAll:!0})}),[]),s=Object(h.useCallback)((()=>{w.ModalManagerV2.openModal({windowId:"1",name:M.ModalIdentitiesDefine.APP_INFO,params:!0})}),[]),n=Object(h.useCallback)(((e,t)=>{A.a.doOpenZaviURL(t,"1")}),[]),o=Object(h.useCallback)(((e,t)=>{var s;N.a.setFlagCopyFromCapture(!!t&&!!t.isCopyFromCap),N.a.setTimeClipboardChanged(performance.now()),null===(s=Object(F.b)())||void 0===s||s.setTimeClipboardChanged(performance.now())}),[]),i=(t,s)=>{const n=L.default.getFriendsSync();A.a.doActionWithUri(s,e,n)},r=(t,{term:s,data:n})=>{switch(s){case"id":A.a.autoOpenConversationById(n,e),n.startsWith(M.GROUPID_PREFIX)?j.e.logAction(2220801):n.startsWith(M.OA_ID_PREFIX)?j.e.logAction(2220803):j.e.logAction(2220802);break;case"phone":j.e.logAction(2220804),A.a.autoOpenConversationByPhone(n,e);break;case"username":j.e.logAction(2220805),A.a.autoOpenConversationByUsername(n,e);break;default:R.a.createError(z.default.str("STR_GROUP_NO_EXIST"))}};Object(h.useEffect)((()=>($zsub.$zuri.onNewRequest(i),$zsub.$zuri.onRequestOpenConv(r),()=>{$zsub.$zuri.removeListenNewRequest(i),$zsub.$zuri.removeListenRequestOpenConv(r)})),[e]),Object(h.useEffect)((()=>{$zsub.$zapp.onRequestShowPreference(t),$zsub.$zapp.onRequestShowAbout(s),$zsub.$zuri.onRequestOpenZavi(n),$zsub.$zresource.onClipboardChange(o)}),[])})(t),m.a.createElement(g.c,Object(u.a)({emitter:s,dispatch:t},n))},B=((...e)=>({children:t})=>e.reduceRight(((e,[t,s={}])=>m.a.createElement(t,s,e)),t))([b.a,{store:p.default}],[b.a,{store:S.a,context:S.b}],[b.a,{store:y.a,context:T.a}],[b.a,{store:I.a,context:D.a}],[b.a,{store:$.b,context:$.a}],[E.b],[v.c],[C.a]),k=()=>m.a.createElement(B,null,m.a.createElement(f,null),m.a.createElement(P,null));var U,Z=s("Mgpg");let x=Object(n.injectable)()(U=function(e,t){return Object(n.inject)(i.a)(e,void 0,0)}(U=function(e,t){return Object(n.inject)(Z.ZLoggerFactory)(e,void 0,1)}(U=Reflect.metadata("design:type",Function)(U=Reflect.metadata("design:paramtypes",[void 0===i.a?Object:i.a,void 0===Z.ZLoggerFactory?Object:Z.ZLoggerFactory])(U=class extends r.a{constructor(e,t){super("zalo",e,t,{component:k,container:document.getElementById("app")})}async start(){this.setupIdleDetector(),await super.start()}setupIdleDetector(){const e=this.config.get("idle_detector"),t=new l(e);t.addEventListener(a.Idle,(()=>{this.setStateToIdle()})),t.addEventListener(a.Active,(()=>this.setStateToActive())),t.start(),this.disposables.add((()=>t.stop())),document.hasFocus()?this.setStateToActive():this.setStateToIdle()}})||U)||U)||U)||U)||U;n.ModuleContainer.registerSingleton(o.a,x)},WrSY:function(e,t,s){"use strict";s("EmOc"),s("ezdo"),s("KdAX"),s("mzek"),s("aBYf"),s("zm+Q"),s("WSI5"),s("v/rv"),s("nAZb"),s("c0KM"),s("zheM"),s("CXIs"),s("cZjg");var n=s("YrRS");Object(n.b)()},goVM:function(e,t,s){"use strict";var n=s("8/YW"),o=s("PmZf"),i=s("YZti"),r=s("1UUk"),a=s("jDHv"),c=s("Mk04"),d=s("Mgpg");s("7nHs");var l=s("LwMt"),u=s("PoHQ"),h=s("DOOx");const m=Object(c.a)((()=>{try{$zapp.notifyDbFail()}catch(e){}})),b=Object(c.a)((()=>{u.o.triggerEvent(u.n,[{type:h.b.OUT_OF_MEM,src:h.a.DB}]),m()})),g=Object(c.a)((()=>{$zdb.notifyOpenDBFailed(!0,"VersionError")})),p=Object(c.a)((()=>{$zdb.notifyOpenDBFailed(!0,"zkey-miss-object-store"),m()})),v=Object(c.a)((()=>{$zdb.notifyOpenDBFailed(!1),m()})),E=Object(c.a)((()=>{$zapp.notifyBuReady()}));var C=s("igA5"),_=s("fc/q");let O=!1;const f=151004;var y;let T=Object(n.g)()(y=Reflect.metadata("design:type",Function)(y=Reflect.metadata("design:paramtypes",[])(y=class{constructor(){this.logger=void 0,this.logErrorMessageOnce=Object(c.a)((e=>{this.logger.zsymb(18,"h_G_2l",e)})),this.dispose=()=>{};const e=a.ModuleContainer.resolve(d.ZLoggerFactory);this.logger=e.createZLogger("db",["error-handler"])}onDispose(){this.dispose()}init(){const e=a.ModuleContainer.resolve(r.b),t=e=>{const{error:t}=e,{name:s,message:n}=t;("QuotaExceededError"===s||"AbortError"===s&&n.includes("Version change transaction was aborted in upgradeneeded event handler.")||n.includes("malformed"))&&(this.logErrorMessageOnce(`OutOfMemError: ${n}`),b())},s=e=>{const{error:t}=e;i.b.isInvalidVersionError(t)&&(this.logErrorMessageOnce(`${t}`),g())},n=e=>{const{error:t}=e;i.b.isMissingTableError(t)&&(this.logErrorMessageOnce(`${t}`),p())},c=e=>{const{error:t}=e;if(i.b.isFailedToOpenConnectionError(t)){const e=`${t}`;this.logErrorMessageOnce(e),v(),(e=>{if(!O){O=!0;try{const t=a.ModuleContainer.resolve(_.a);t.log({commandId:f,success:!0});const s=Date.now(),n=C.default.getInstance();let o=n.getItem("fa_op_d_rec_dt");if(null!==o){const n=+o;Number.isNaN(n)||s-n<=36e5&&t.log({commandId:f,success:!1,params:[e]})}n.setItem("fa_op_d_rec_dt",`${s}`)}catch(t){}}})(e)}},d=e=>{t(e),s(e),n(e),c(e)},u=e=>{E()},h=e=>{this.logErrorMessageOnce(`DB connection closed abnormally: '${e.database}'`),a.ModuleContainer.resolve(l.a).forceCheckDBCorruption()};e.addEventListener(o.b.QueryError,d),e.addEventListener(o.b.SuccessOpenDB,u),e.addEventListener(o.b.ConnectionClosedAbnormally,h),this.dispose=()=>{e.removeEventListener(o.b.QueryError,d),e.removeEventListener(o.b.SuccessOpenDB,u),e.removeEventListener(o.b.ConnectionClosedAbnormally,h)}}})||y)||y)||y;(new T).init()},jw3m:function(e,t,s){},o0oJ:function(e,t,s){(function(e){const t={};function s(e){return t[e]||(t[e]=0),t[e]+=1,100*e+t[e]}if(!e.perf){let t=()=>Date.now();const n={STARTUP:s(1),MIGRATION_DONE:s(2),MAIN_SCRIPT:s(2),LOADED_MAIN_SCRIPT:s(3),MAIN_APP_READY:s(3),LOADED_STARTUP_SCRIPT:s(2),STARTUP_BEFORE_HEAVY:s(3),CREATE_MAIN_WINDOW:s(3),SHOW_MAIN_WINDOW:s(3),MAIN_WINDOW_LOADING:s(3),MAIN_WINDOW_LOADED:s(3),APP_STARTUP:s(2),LOAD_APP_SCRIPT:s(3),APP_DID_MOUNT:s(3),CHATBOX_DID_MOUNT:s(3),SELECT_CONVERSATION:s(1),SELECTED_CONVERSATION:s(2)};e.perf={...n,perfRecords:[],record:s=>{s||(s=0);const n=[s,t()];e.perf.perfRecords.push(n)}}}}).call(this,s("yLpj"))},tPRg:function(e,t,s){"use strict";s("o0oJ"),s("dThN"),s("z0WU"),s("vSga"),s("XS0u");perf.record(perf.LOAD_APP_SCRIPT),function(){window.__loadTimer&&clearTimeout(window.__loadTimer);window.__startTime&&$zlogger.loadShellQos(Date.now()-window.__startTime)}()},vUp1:function(e,t,s){"use strict";var n,o=s("VTBJ"),i=s("hI9i"),r=s("rCQs"),a=s("rfrl"),c=s("7nHs");const d={isShown:!1,modalTitle:"",guideTitle:"",errorCode:"",guideItems:[],showReloadBtn:!0,reloadBtnName:"STR_BU_CONFIRM_TEXT_6",showDeleteDataBtn:!0,deleteDataBtnName:"STR_BU_CANCEL_TEXT_6"};Object(r.b)(c.a)(n=class{constructor(){this.name=c.b,this.key="",this.state=d}setState(e){const t=Object(a.a)(this.state,e);this.state!==t&&(this.state=t,Object(i.g)(this.name,""))}showModal(e){this.state.isShown||this.setState((t=>Object(o.a)(Object(o.a)(Object(o.a)({},t),e),{},{isShown:!0})))}closeModal(){this.state.isShown&&this.setState((e=>Object(o.a)(Object(o.a)(Object(o.a)({},e),d),{},{isShown:!1})))}init(e){}getItem(e,t){return this.state}getList(e,t){return[]}onGetItemFailure(e,t){throw new Error("Method not implemented.")}onGetListFailure(e,t){throw new Error("Method not implemented.")}})}}]);
//# sourceMappingURL=../sourcemaps/lazy/default-login-startup-main-startup.7e1475db6a670bbac9ad.js.map